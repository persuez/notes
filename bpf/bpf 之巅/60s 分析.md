# 传统工具

1. uptime
2. dmesg | tail
3. vmstat 1
4. mpstat -P ALL 1
5. pidstat 1
6. iostat -xz 1
7. free -m
8. sar -n DEV 1
9. sar -n TCP,ETCP 1
10. top



## uptime

uptime 包括 IO 负载。

三个值分别是 1分钟，5分钟，15分钟的系统平均负载。平均负载是指单位时间内，系统处于可运行状态和不可中断状态的平均进程数，也就是平均活跃进程数，它和 CPU 使用率并没有直接关系。所谓可运行状态的进程，是指正在使用 CPU 或者正在等待 CPU 的进程，也就是我们常用 ps 命令看到的，处于 R 状态（Running 或 Runnable）的进程。不可中断状态的进程则是正处于内核态关键流程中的进程，并且这些流程是不可打断的，比如最常见的是等待硬件设备的 I/O 响应，也就是我们在 ps 命令中看到的 D 状态（Uninterruptible Sleep，也称为 Disk Sleep）的进程。



比如，当一个进程向磁盘读写数据时，为了保证数据的一致性，在得到磁盘回复前，它是不能被其他进程或者中断打断的，这个时候的进程就处于不可中断状态。如果此时的进程被打断了，就容易出现磁盘数据与进程数据不一致的问题。



因此，你可以简单理解为，平均负载其实就是平均活跃进程数。平均活跃进程数，直观上的理解就是单位时间内的活跃进程数，但它实际上是活跃进程数的指数衰减平均值。这个“指数衰减平均”的详细含义你不用计较，这只是系统的一种更快速的计算方式，你把它直接当成活跃进程数的平均值也没问题。既然平均的是活跃进程数，那么最理想的，就是每个 CPU 上都刚好运行着一个进程，这样每个 CPU 都得到了充分利用。比如当平均负载为 2 时，意味着什么呢？在只有 2 个 CPU 的系统上，意味着所有的 CPU 都刚好被完全占用。在 4 个 CPU 的系统上，意味着 CPU 有 50% 的空闲。而在只有 1 个 CPU 的系统中，则意味着有一半的进程竞争不到 CPU。



## vmstat 1

虚拟内存信息统计命令，但除了内存信息，还会打印 cpu 信息。

每隔 1s 打印系统的状态值，第一行为系统自启动以来的总结信息，除了第一列的 r 值为当前运行对列长度。

us/sy/id/wa/st 均是平均值。

比如应用进程在用户空间占满了 一个核，但是由于系统中有 8 个核，所以 us 是 100 / 8 = 12，所以 vmstat 反映的是整个系统的情况，即使有个性能不好的进程一直占满某个核，通过 vmstat 也看不出什么来。



## mpstat -P ALL 1

多处理器信息统计工具。

-P ALL 指报告所有 CPU 的信息，1 表示每1秒报告一次。

这个命令补足了 vmstat 的不全

而且对于比较大的值，会标红显示



## pidstat 1

每隔1s报告进程信息，大的值会标红

默认报告 cpu 信息

pidstat 1 -r 会报告内存信息，包括 minflt、majflt、rss、vsz

